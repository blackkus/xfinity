!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id="dl-plugin-traits",this.storageTraits=sessionStorage.getItem(this.id),this.storageTraits=this.storageTraits?JSON.parse(this.storageTraits):null,this.bindListeners(),this.debug(this.id+": intialized")}return r(e,[{key:"bindListeners",value:function(){document.addEventListener("c-tracking-load-defaults",this.populateDataLayer.bind(this),!1)}},{key:"debug",value:function(){window.trackingDebug&&console.info.apply(this,[].concat(Array.prototype.slice.call(arguments)))}},{key:"populateDataLayer",value:function(e){this.debug(this.id+": Send plugin information to data layer"),e.detail.plugins.push({name:this.id,version:"1.0.0",description:"Pass Data-Layer information to traits end point",errorDetected:this.checkErrors()}),e.detail.segment=e.detail.segment||{},e.detail.segment.traits=e.detail.segment.traits||[],this.checkErrors()||(this.storageTraits?(this.debug(this.id+": Traits are in sessionStorage"),this.populateTraits(e.detail.segment.traits)):(this.debug(this.id+": Traits are NOT in sessionStorage"),this.getTraits()))}},{key:"checkCookie",value:function(e){if(document.cookie.split(";").filter(function(t){return t.indexOf(e+"=")>=0}).length)return!0}},{key:"storageAvailable",value:function(e){try{var t=window[e],i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==t.length}}},{key:"checkErrors",value:function(){return!this.pluginError&&"function"==typeof XMLHttpRequest&&this.storageAvailable("sessionStorage")&&this.checkCookie("SC")||(this.pluginError=!0),this.pluginError}},{key:"getTraits",value:function(){if(this.executed)this.debug(this.id+": API has been called");else{this.debug(this.id+": Requesting traits from API"),this.executed=!0;var e=new XMLHttpRequest;e.open("GET","/learn/api/neptune/prospect/traits",!0),e.onreadystatechange=this.processTraits.bind(this),e.setRequestHeader("Accept","application/json, text/plain, */*"),e.send()}}},{key:"processTraits",value:function(e){if(e.target.readyState===XMLHttpRequest.DONE)if(200===e.target.status)try{var t=JSON.parse(e.target.responseText).Data.Traits;t?(sessionStorage.setItem(this.id,JSON.stringify(t)),this.debug(this.id+": Traits from API:",t)):this.debug(this.id+": There is no Traits Object in the response, can't save into sessionStorage")}catch(e){this.debug(this.id+": The API response does not contain traits. Error(s)",e)}else this.debug(this.id+": There was a problem with the request.",e.target)}},{key:"populateTraits",value:function(e){var t=this;Object.keys(this.storageTraits).forEach(function(i){t.debug(t.id+': pushing name - "'+i+'" and type - "'+t.storageTraits[i]+'"'),e.push({name:i,type:t.storageTraits[i]})})}}]),e}();t.default=n;new n}]);