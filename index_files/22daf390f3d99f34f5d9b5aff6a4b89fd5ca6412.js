(function() {
    var mappings = [{
  "name": "Xfinity.com/mobile_RTG_ACQ_4599517_ConfirmationPage",
  "urls": ["https://www.xfinity.com/mobile/confirmation"]
}, {
  "name": "Xfinity.com/mobile_RTG_ACQ_4597163_CheckoutReview",
  "urls": ["https://www.xfinity.com/mobile/checkout/review"]
}, {
  "name": "Xfinity.com/mobile_RTG_ACQ_4597432_CheckoutPayment",
  "urls": ["https://www.xfinity.com/mobile/checkout/payment"]
}, {
  "name": "Xfinity.com/mobile_RTG_ACQ_4597821_CheckoutShipping",
  "urls": ["https://www.xfinity.com/mobile/checkout/shipping"]
}, {
  "name": "Xfinity.com/mobile_RTG_ACQ_4597523_CustomizeYourCart",
  "urls": ["https://www.xfinity.com/mobile/cart"]
}, {
  "name": "Xfinity.com/mobile_RTG_ACQ_4597632_CustomizePlan",
  "urls": ["https://www.xfinity.com/mobile/*/customizer/plan"]
}, {
  "name": "Xfinity.com/mobile_RTG_ACQ_4597524_CheckoutLogin",
  "urls": ["https://www.xfinity.com/mobile/*/customizer/identity-verification"]
}, {
  "name": "Xfinity.com/mobile_RTG_ACQ_4599513_Support",
  "urls": ["https://www.xfinity.com/mobile/support"]
}, {
  "name": "Xfinity.com/mobile_RTG_ACQ_4597631_CustomizeDevice",
  "urls": ["https://www.xfinity.com/mobile/shop/device/"]
}, {
  "name": "Xfinity.com/mobile_RTG_ACQ_4601190_ShopDevices",
  "urls": ["https://www.xfinity.com/mobile/shop?tab=devices"]
}, {
  "name": "Xfinity.com/mobile_RTG_ACQ_4597517_ShopAccessories",
  "urls": ["https://www.xfinity.com/mobile/shop?tab=accessories"]
}, {
  "name": "Xfinity.com/mobile_6963148 _Bring_Your_Own_Device",
  "urls": ["https://www.xfinity.com/mobile/byod"]
}, {
  "name": "Xfinity.com/mobile_RTG_ACQ_4597623_PlanPage",
  "urls": ["https://www.xfinity.com/mobile/plan"]
}, {
  "name": "Xfinity.com/mobile_RTG_ACQ_4597155_InternationalPlanPage",
  "urls": ["https://www.xfinity.com/mobile/plan/international"]
}, {
  "name": "Xfinity.com/mobile_RTG_ACQ_4599507_Homepage",
  "urls": ["https://www.xfinity.com/mobile"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2723658_Buyflow_OrderConfirmation",
  "urls": ["https://idm.xfinity.com/myaccount/create-uid"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2723658_Buyflow_OrderConfirmation",
  "urls": ["https://www.xfinity.com/checkout/confirmation", "https://www.xfinity.com/buy/confirmation", "https://idm.xfinity.com/myaccount/create-uid"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2721063_Buyflow_OrderCustomization",
  "urls": ["https://www.xfinity.com/customization/", "https://www.xfinity.com/buy/"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2723661_Buyflow_OrderCustomization_Multicultural",
  "urls": ["https://es.xfinity.com/customization/", "https://es.xfinity.com/buy/"]
}, {
  "name": "Comcast-Xfinity Customers Come First",
  "urls": ["https://www.xfinity.com/customers-come-first"]
}, {
  "name": "Comcast-Xfinity Help and Support Cancel Xfinity",
  "urls": ["https://www.xfinity.com/support/articles/cancel-my-xfinity-services"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3701725_ContactUs",
  "urls": ["https://www.xfinity.com/support/contact-us"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3421191_Learn&Landing_MoveTransferDeals",
  "urls": ["https://www.xfinity.com/moving", "https://www.xfinity.com/learn/moving", "https://www.xfinity.com/learn/move/offers", "https://www.xfinity.com/buy/plan/move"]
}, {
  "name": "DBM_RTG_ACQ_6606768_XFINITY_Instant_TV",
  "urls": ["https://www.xfinity.com/learn/instant-tv"]
}, {
  "name": "Xfinity.com_RTG_ACQ_4497712_Upgrade",
  "urls": ["https://www.xfinity.com/learn/existing/offers", "https://www.xfinity.com/lp/ppc/upgrade-xfinity-internet-service", "https://www.xfinity.com/upgrade-center/offers", "https://www.xfinity.com/upgrade", "https://www.xfinity.com/Corporate/Learn/DigitalCable/premium-channels", "https://www.xfinity.com/myplan", "https://www.xfinity.com/buy/plan"]
}, {
  "name": "Xfinity.com_RTG_ACQ_ 3423384_Homepage_CustomerHomepage",
  "urls": ["https://customer.xfinity.com/", "https://www.xfinity.com/bill-pay", "https://www.xfinity.com/apps", "https://www.xfinity.com/customer-home", "https://www.xfinity.com/manage-my-account"]
}, {
  "name": "DFA Floodlight Refer A Friend_Dashboard",
  "urls": ["https://referafriend.xfinity.com/dashboard"]
}, {
  "name": "Xfinity.com_RTG_ACQ_4497712_Help&Support",
  "urls": ["https://www.xfinity.com/support"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3675199_Learn&Landing_MyXfinity 2016",
  "urls": ["https://my.xfinity.com"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2728105_Multicultural_Hispanic",
  "urls": ["https://www.xfinity.com/learn/digital-cable-tv/latino", "https://www.xfinity.com/latino/packages", "https://www.xfinity.com/tuidioma", "https://www.xfinity.com/parami"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2727704_Multicultural_Hispanic_Multicultural",
  "urls": ["https://es.xfinity.com/"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2724308_Learn&Landing_TriplePlay",
  "urls": ["https://www.xfinity.com/Corporate/Learn/Bundles/bundles.html", "https://www.xfinity.com/shop/xfinity-tripleplay", "https://www.xfinity.com/m/triple-play", "https://www.xfinity.com/m/tv-internet-voice", "https://www.xfinity.com/learn/offers?lob=tv,internet,voice", "https://www.xfinity.com/learn/bundles/triple-play"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2723668_Learn&Landing_DoublePlay",
  "urls": ["https://www.xfinity.com/cable-internet-packages.html", "https://www.xfinity.com/shop/xfinity-doubleplay", "https://www.xfinity.com/learn/xfinity-doubleplay", "https://www.xfinity.com/m/cable-internet-packages", "https://www.xfinity.com/learn/offers?lob=tv,internet", "https://www.xfinity.com/learn/bundles/internet-cable-packages"]
}, {
  "name": "Xfinity_Learn_ChannelLineUp",
  "urls": ["https://www.xfinity.com/learn/channel-lineup"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2724229_Learn&Landing_X1",
  "urls": ["https://www.xfinity.com/voice-remote", "https://www.xfinity.com/learn/digital-cable-tv/x1"]
}, {
  "name": "Xfinity.com_RTG_NA_2875772_Stream_Stream",
  "urls": ["https://www.xfinity.com/get-stream"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3852531_Learn&Landing_Netflix",
  "urls": ["https://www.xfinity.com/netflix"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2724312_Learn&Landing_Video",
  "urls": ["https://www.xfinity.com/learn/digital-cable-tv", "https://www.xfinity.com/Corporate/Learn/DigitalCable", "https://www.xfinity.com/shop/xfinity-cable", "https://www.xfinity.com/m/digital-cable", "https://www.xfinity.com/learn/offers?lob=tv"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2722062_Learn&Landing_HSD",
  "urls": ["https://www.xfinity.com/internet-service.html", "https://www.xfinity.com/shop/xfinity-internetplus", "https://www.xfinity.com/learn/xfinity-internetplus", "https://www.xfinity.com/m/internet-service", "https://www.xfinity.com/learn/internet-service", "https://www.xfinity.com/learn/offers?lob=internet"]
}, {
  "name": "Xfinity.com_RTG_ACQ_6034090_Learn&Landing_Mobile-Service",
  "urls": ["https://www.xfinity.com/learn/mobile-service"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2724714_Learn&Landing_Voice",
  "urls": ["https://www.xfinity.com/home-phone-service.html", "https://www.xfinity.com/m/voice", "https://www.xfinity.com/learn/offers?lob=voice", "https://www.xfinity.com/learn/home-phone-services"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2721071_Learn&Landing_Deals",
  "urls": ["https://www.xfinity.com/Corporate/shop/productoverview.html", "https://www.xfinity.com/learn/offers", "https://www.xfinity.com/learn/help-me-decide"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2728103_Learn&Landing_XHS",
  "urls": ["https://www.xfinity.com/home-security", "https://www.xfinity.com/learn/home-security", "https://www.xfinity.com/shop/xfinity-homesecurity", "https://www.xfinity.com/homeoffer.html", "https://www.xfinity.com/quad-play", "https://www.xfinity.com/learn/bundles/quad-play"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3377935_Learn&Landing_Xfinity-vs-CenturyLink",
  "urls": ["https://www.xfinity.com/compare/comcast-xfinity-vs-centurylink"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3380707_Learn&Landing_Xfinity-vs-Directv",
  "urls": ["https://www.xfinity.com/compare/comcast-xfinity-vs-directv"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3377643_Learn&Landing_Xfinity-vs-DishNetwork",
  "urls": ["https://www.xfinity.com/compare/comcast-xfinity-vs-dish-network"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3377028_Learn&Landing_Xfinity-vs-VerizonFios",
  "urls": ["https://www.xfinity.com/compare/comcast-xfinity-vs-verizon-fios"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3380567_Learn&Landing_Xfinity-vs-GoogleFiber",
  "urls": ["https://www.xfinity.com/compare/comcast-xfinity-vs-google-fiber"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3380161_Learn&Landing_Xfinity-vs-Competition",
  "urls": ["https://www.xfinity.com/xfinity-vs-competition"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3380332_Learn&Landing_Xfinity-vs-Uverse-vs-Directv",
  "urls": ["https://www.xfinity.com/compare/comcast-xfinity-vs-att-u-verse-directv"]
}, {
  "name": "Xfinity.com_RTG_ACQ_4497712_Learning&Landing_Local",
  "urls": ["https://www.xfinity.com/local/", "https://www.xfinity.com/support/service-center-locations"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3177760_Buyflow_LocalSearchPages",
  "urls": ["https://www.xfinity.com/locations/"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3248728_Gig-offer",
  "urls": ["https://www.xfinity.com/gig-offer"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3249796_Gig",
  "urls": ["https://www.xfinity.com/gig"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3472860_Nascar",
  "urls": ["https://www.xfinity.com/sports/nascar", "https://www.xfinity.com/learn/digital-cable-tv/sports/nascar"]
}, {
  "name": "Xfinity.com_RTG_ACQ_3489312_Sports",
  "urls": ["https://www.xfinity.com/sports", "https://www.xfinity.com/learn/digital-cable-tv/sports"]
}, {
  "name": "18_1_Xfinity.com_6950488_esports",
  "urls": ["https://www.xfinity.com/esports"]
}, {
  "name": "Xfinity.com_RTG_ACQ_2723464_Homepage_Homepage",
  "urls": ["https://www.xfinity.com/", "https://www.xfinity.com/m", "https://www.xfinity.com/learn/home"]
}]
;

    var retargetingURL = "https://rt.spongecell.com/v1/r/1300?_id=119";
    var settings = window.SpongecellActivityTag;

    var mapper = function(mappings, pageURL) {
  // console.log("pageURL", pageURL);
  var segmentMatches = {};

  mappings.forEach(function(mapping) {
    var patterns = mapping.urls;
    var patternMatches = patterns.forEach(function(pattern) {
      pattern = pattern.replace("http://", "https://");
      pattern = pattern.replace(/[?]/g, "\\?");  // escape special characters for regular expression
      pattern = pattern.replace("*", "(.*)");
      pattern = "^" + pattern;
      // console.log("pattern", pattern)
      var re = new RegExp(pattern, 'i'); // case insensitive
      // console.log("match", re.exec(pageURL))
      var match = re.exec(pageURL);
      if (match != null) {
        segmentMatches[mapping.name] = match;
      }
    });
  });
  var matchingSegments = Object.keys(segmentMatches);
  var longestMatchLength = 0;
  var longestMatchedSegment = null;
  matchingSegments.forEach(function(segment) {
    // console.log("segment", segment);
    var match = segmentMatches[segment];
    var matchedText = match[0];
    if (matchedText.length > longestMatchLength) {
      longestMatchLength = matchedText.length;
      longestMatchedSegment = segment;
    }
  });
  // console.log("longestMatchedSegment", longestMatchedSegment);
  return longestMatchedSegment;
}
;

    // map URLs to retargeting segments
    var pageURL = settings.page_url;
    settings["retargeting_segment"] = mapper(mappings, pageURL);

    // convert all data attributes to retargeting parameters and fire the retargeting pixel
    for (var setting in settings) {
        if (settings.hasOwnProperty(setting)) {
            var value = settings[setting];
            retargetingURL += "&" + setting + "=" + encodeURIComponent(value);
        }
    }

    function firePixel(url) {
        var img = document.createElement("img");
        img.style = "display: none;";
        img.src = url + "&cache_buster=" + Math.floor(Math.random() * 10e12);
        // tag.parentNode.insertBefore(img, tag);
    }

    firePixel(retargetingURL);

    // fire the adobe sync pixel
    firePixel("https://analytics.spongecell.com/sync/6/?r=https%3A%2F%2Fdpm.demdex.net%2Fibs%3Adpid%3D22053%26dpuuid%3D%5BSPONGEKEY%5D");
})();
